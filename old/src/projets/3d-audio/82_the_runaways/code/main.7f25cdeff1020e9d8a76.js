webpackJsonp([0],[,function(e,t,i){"use strict";(function(e){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function t(n){i(this,t),this.simplex=n.simplex,this.config=n.config,this.origin=n.origin?n.origin:new e.Vector3(0,110,0),this.initPosition(n.position,n.ejected),this.oldPosition=this.position.clone(),this.noise={base:[Math.floor(20*Math.random()),Math.floor(20*Math.random()),Math.floor(20*Math.random())]},this.velocity=new e.Vector3}return n(t,[{key:"initPosition",value:function(e,t){this.position=e||this.origin.clone(),t&&(console.log("Ball ejected"),this.direction=t)}},{key:"approachDirection",value:function(){console.log("Approach");var e=[this.direction.x-this.position.x,this.direction.y-this.position.y,this.direction.z-this.position.z];this.position.x=this.position.x+.05*e[0],this.position.y=this.position.y+.05*e[1],this.position.z=this.position.z+.05*e[2],Math.abs(e[0])<5&&Math.abs(e[1]),Math.abs(e[2])<5&&(this.direction=!1)}},{key:"update",value:function(t){if(this.direction)this.approachDirection();else{var i={x:this.simplex.noise2D(this.noise.base[0],t)*this.config.ratVelocity,y:this.simplex.noise2D(this.noise.base[1],t)*this.config.ratVelocity,z:this.simplex.noise2D(this.noise.base[2],t)*this.config.ratVelocity},n={x:this.position.x+i.x,y:this.position.y+i.y,z:this.position.z+i.z};Math.abs(n.x)>this.config.limit.x&&(i.x*=-1),Math.abs(n.z)>this.config.limit.z&&(i.z*=-1),(n.y<0||n.y>this.config.limit.y)&&(i.y=0),this.velocity=new e.Vector3(i.x,i.y,i.z),this.position.add(this.velocity)}}}]),t}();t.default=o}).call(t,i(0))},function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(9),r=n(s),c=i(13),l=n(c),h=i(5),u=n(h),d=i(8),f=(n(d),i(14)),m=n(f),v=i(6),p=n(v),y=i(1),g=(n(y),i(7)),x=n(g),b=i(11),w=n(b),_=i(12),M=n(_),k=function(){function t(){var i=this;o(this,t),this.config=p.default,this.scene=new e.Scene,this.container=document.querySelector("#main"),this.renderer=new e.WebGLRenderer({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.animate(this.render.bind(this)),document.body.appendChild(this.container),this.sound=new w.default(M.default,45,0,function(){i.sound.play(90),i.audio()},!1),this.average=0,this.simplex=new l.default,this.camera=new e.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,this.config.camera.far),this.camera.position.z=this.config.camera.position.z,this.camera.position.y=this.config.camera.position.y,this.balls=[],this.createBall(),this.camera.lookAt(this.balls[0].leader.position),this.container.appendChild(this.renderer.domElement),window.addEventListener("resize",this.onWindowResize.bind(this),!1),this.onWindowResize(),this.initAnim(),this.initColors(),this.gui=new m.default.GUI,this.sky=new r.default(this.scene,this.gui,this.renderer,this.camera)}return a(t,[{key:"control",value:function(){this.controls=new e.OrbitControls(this.camera,this.renderer.domElement),this.controls.addEventListener("change",this.render),this.controls.enableZoom=!0,this.controls.target.set(0,70,0)}},{key:"mirror",value:function(){new e.PlaneBufferGeometry(1e7,1e7);this.groundMirror=new x.default(5e3,5e3,{clipBias:.01,textureWidth:window.innerWidth*window.devicePixelRatio,textureHeight:window.innerHeight*window.devicePixelRatio,color:7829367}),this.groundMirror.rotateX(-Math.PI/2),this.scene.add(this.groundMirror)}},{key:"initColors",value:function(){for(var e=0;e<this.config.sprites.colors.length;e++)for(var t=0;t<this.config.sprites.colors[e].length;t++)this.config.sprites.colors[e][t]=this.config.sprites.colors[e][t]/255}},{key:"getRandomColor",value:function(){return this.config.sprites.colors[Math.floor(this.config.sprites.colors.length*Math.random())]}},{key:"datgui",value:function(){var e=this,t=this.gui.addFolder("CamÃ©ra");t.add(this.config.camera.position,"x").onChange(function(){e.camera.position.x=e.config.camera.position.x}),t.add(this.config.camera.position,"y").onChange(function(){e.camera.position.y=e.config.camera.position.y}),t.add(this.config.camera.position,"z").onChange(function(){e.camera.position.z=e.config.camera.position.z}),t.add(this.config.camera,"far");var i=this.gui.addFolder("Leader"),n=i.addFolder("Limit");n.add(this.config.leader.limit,"x"),n.add(this.config.leader.limit,"y"),n.add(this.config.leader.limit,"z"),i.add(this.config.leader,"ratVelocity",0,100);var o=this.gui.addFolder("Sprites");o.add(this.config.sprites,"nEach",10,500),o.add(this.config.sprites,"nbVertice",1e4,5e6).onChange(function(){for(var t=0;t<e.balls.length;t++)e.balls[t].resetting=!0,e.balls[t].initShader(),e.balls[t].createPoints()}),o.add(this.config.sprites,"velocityFactor",1,5e5),o.add(this.config.sprites,"degradation",0,1).onChange(function(){for(var t=0;t<e.balls.length;t++)e.balls[t].material.uniforms.u_nb_vertex.value=e.balls[t].points.length*e.config.sprites.degradation}),o.add(this.config.sprites.sprite,"maxSize",0,20).onChange(function(){for(var t=0;t<e.balls.length;t++)e.balls[t].material.uniforms.u_max_size.value=e.config.sprites.sprite.maxSize}),o.add(this.config.sprites.sprite,"positionNoiseRat",1,5e3).onChange(function(){for(var t=0;t<e.balls.length;t++)e.balls[t].material.uniforms.u_position_noise_rat.value=e.config.sprites.sprite.positionNoiseRat}),o.add(this.config.sprites.sprite,"baseRadius",1,200).onChange(function(){for(var t=0;t<e.balls.length;t++)e.balls[t].material.uniforms.u_ball_base_radius.value=e.config.sprites.sprite.baseRadius}),o.add(this.config.sprites.sprite,"noiseDiffusion",1,500).onChange(function(){for(var t=0;t<e.balls.length;t++)e.balls[t].material.uniforms.u_noise_diffusion.value=e.config.sprites.sprite.noiseDiffusion})}},{key:"initAnim",value:function(){this.animation={},this.animation.current=Date.now(),this.animation.timeleft=0}},{key:"createBall",value:function(e){this.balls.push(new u.default(this.scene,{context:{parent:this},color:this.getRandomColor(),simplex:this.simplex,config:this.config.sprites,leaderConfig:this.config.leader,comet:e||null,average:this.average?this.average:null}))}},{key:"randomBallRank",value:function(e){var t,i=!e.length,n=0;do{if(t=Math.floor(Math.random()*this.balls.length),e.length){i=!0;for(var o=0;o<e.length;o++)(e[o]===t||this.balls[t].dying||this.balls[t].mergeAnim.commet)&&(i=!1)}}while(!i);t=Math.floor(Math.random()*this.balls.length),i=!0;for(var o=0;o<e.length;o++)(e[o]===t||this.balls[t].dying||this.balls[t].mergeAnim.commet)&&(i=!1);if(!(++n>100))return t}},{key:"getBehaviourKick",value:function(){var e,t;return this.balls.length>5?(e=!0,t=Math.random()>.5):(e=Math.random()<.2&&this.balls.length>1,t=!0),{create:t,merge:e}}},{key:"mergeRandom",value:function(){var e=this.randomBallRank([]),t=this.randomBallRank([e]);this.balls[e].merge(this.balls[t])}},{key:"createRandom",value:function(){var e=this.randomBallRank([]);this.createBall(this.balls[e])}},{key:"audio",value:function(){var e=this,t=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),i=this.sound.createKick({frequency:[30,31,32,33],decay:.4,threshold:t?195:218,onKick:function(){if(i.lastKick&&Date.now()-i.lastKick>2e3){var t=e.getBehaviourKick();t.merge&&e.mergeRandom(),t.create&&e.createRandom(),i.lastKick=Date.now()}}});i.lastKick=Date.now(),i.on()}},{key:"audioUpdate",value:function(){this.sound.updateAverageSmooth(),this.config.leader.ratVelocity=average/20;for(var e=0;e<this.balls.length;e++)this.balls[e].material.uniforms.u_max_size.value=1+average/20}},{key:"cameraSmooth",value:function(t){var i=this.simplex.noise2D(t/4e3,1)+1.1,n=600-60*Math.sin(t/1e3)-60;this.camera.position.x=Math.cos(t/1e3)*n,this.camera.position.z=Math.sin(t/1e3)*n,this.camera.position.y=150*i,this.camera.lookAt(new e.Vector3(0,60,0))}},{key:"onWindowResize",value:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}},{key:"manageDeletedBalls",value:function(){if(this.toRemove){for(var e=null,t=0;t<this.balls.length;t++)if(this.balls[t].name==this.toRemove){e=t;break}e>=0&&this.balls.splice(e,1),this.toRemove=null}}},{key:"render",value:function(){var e=Date.now();this.sky&&this.sky.update(e/1e4);var t=this.sound.getAverage();this.average=this.average+.2*(t-this.average),this.config.leader.ratVelocity=this.average/150;for(var i=0;i<this.balls.length;i++)this.balls[i].update(e,this.average);this.cameraSmooth(e),this.renderer.render(this.scene,this.camera),this.manageDeletedBalls()}}]),t}();t.default=k}).call(t,i(0))},function(e,t){},function(e,t,i){"use strict";i(3);var n=i(2),o=function(e){return e&&e.__esModule?e:{default:e}}(n);window.app=new o.default},function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(16),r=n(s),c=i(15),l=n(c),h=i(1),u=n(h),d=function(){function t(i,n){o(this,t),this.context=n.context,this.scene=i,this.name="Commet-"+Math.floor(1e12*Math.random()),this.config=n.config,this.time=0,this.leaderPosition=n.comet?n.comet.leader.position.clone():new e.Vector3(0,30,0),this.dying=!1,this.dyingCount=1,this.mergeAnim={commet:null,start:0},this.style={color:{from:new e.Vector3(n.color[0],n.color[1],n.color[2]),to:new e.Vector3(Math.random(),Math.random(),Math.random())},radius:n.radius?n.radius:this.config.sprite.baseRadius,radiusFact:1,nbPoints:this.config.nbVertice,dispersion:50},this.manageAppear(n.comet,n.average),this.points=new Array(this.style.nbPoints).fill(0),this.initShader(),this.scene.add(this.starField),this.leaderAnim=!0,this.leader=new u.default({simplex:n.simplex,config:n.leaderConfig,position:this.leaderPosition,ejected:this.ejectionCoord}),this.createPoints()}return a(t,[{key:"manageAppear",value:function(t,i){if(i&&(this.style.radius=this.config.sprite.baseRadius+i/2,this.style.nbPoints=this.config.nbVertice+Math.floor(100*i),console.log(this.style.nbPoints)),t)return this.ejectionCoord=new e.Vector3(600*Math.random()-300,400*Math.random()-200,600*Math.random()-300),void(this.style.dispersion=10+500*Math.random());this.style.radius=50,this.ejectionCoord=null}},{key:"removePermanently",value:function(){this.context.parent.toRemove=this.name;var e=this.scene.getObjectByName(this.name);e.parent.remove(e)}},{key:"remove",value:function(){this.dying=!0,this.dyingCount=1}},{key:"initShader",value:function(){this.starsGeometry=new e.BufferGeometry,this.vertices=new Float32Array(new Array(3*this.style.nbPoints).fill(0)),this.starsGeometry.addAttribute("position",new e.BufferAttribute(this.vertices,3));var t=new Float32Array(new Array(this.style.nbPoints).fill(0).map(function(e,t){return parseFloat(t)}));this.starsGeometry.addAttribute("rank",new e.BufferAttribute(t,1));var i=new Float32Array(new Array(this.style.nbPoints).fill(0).map(function(e,t){return Math.random()}));this.starsGeometry.addAttribute("rand",new e.BufferAttribute(i,1));var n={u_time:{type:"f",value:0},u_nb_vertex:{type:"f",value:this.points.length},u_ball_base_radius:{type:"f",value:this.style.radius},u_color_from:{type:"v3",value:this.style.color.from},u_factor:{type:"f",value:this.style.dispersion}};this.material=new e.ShaderMaterial({uniforms:n,vertexShader:r.default,fragmentShader:l.default,transparent:!0}),this.starField=new e.Points(this.starsGeometry,this.material),this.starField.name=this.name,this.starField.position.y=20}},{key:"resetPoint",value:function(e){var t=Math.random()*Math.PI*2,i=Math.PI/this.config.nbVertice*e;this.points[e]=[this.leader.position.x+Math.cos(t)*Math.sin(i),this.leader.position.y+Math.sin(t)*Math.sin(i),this.leader.position.z+Math.cos(i)]}},{key:"updatePoints",value:function(e){if(this.starsGeometry.attributes.position.needsUpdate=!0,this.dying)this.dyingCount<0&&this.removePermanently(),this.dyingCount-=.02;else for(var t=0;t<this.points.length;t++)this.vertices[3*t]=this.leader.position.x,this.vertices[3*t+1]=this.leader.position.y,this.vertices[3*t+2]=this.leader.position.z}},{key:"createPoints",value:function(){for(var e=0;e<this.config.nbVertice;e++)this.resetPoint(e),this.vertices[3*e]=this.points[0][0],this.vertices[3*e+1]=this.points[0][1],this.vertices[3*e+2]=this.points[0][2];this.material.uniforms.u_nb_vertex.value=this.points.length*this.dyingCount}},{key:"merge",value:function(e,t,i){i=!1!==i,t=t||.03,i&&e.merge(this,t,!1),this.leaderAnim=!1,this.mergeAnim.commet=e,this.mergeAnim.origin=i,this.mergeAnim.last=Date.now(),this.mergeAnim.speed=t,this.mergeAnim.distance=this.leader.position.distanceTo(e.leader.position)}},{key:"stepMerge",value:function(e){var t;this.leader.position.x+=(this.mergeAnim.commet.leader.position.x-this.leader.position.x)*this.mergeAnim.speed,this.leader.position.y+=(this.mergeAnim.commet.leader.position.y-this.leader.position.y)*this.mergeAnim.speed,this.leader.position.z+=(this.mergeAnim.commet.leader.position.z-this.leader.position.z)*this.mergeAnim.speed,t=this.leader.position.distanceTo(this.mergeAnim.commet.leader.position),this.style.radiusFact=t/this.mergeAnim.distance,t<2&&(this.leaderAnim=!0,this.mergeAnim.commet=null,this.mergeAnim.origin&&this.remove())}},{key:"update",value:function(e,t){var i=.001;i=t/128*.01+.001,this.time+=i,this.leaderAnim?(this.leader.update(this.time),this.style.radiusFact<1&&!this.dying&&(this.style.radiusFact+=.01)):this.mergeAnim.commet&&this.stepMerge(e),this.material.uniforms.u_ball_base_radius.value=(this.style.radius+t/5)*this.style.radiusFact,this.material.uniforms.u_time.value=this.time,this.updatePoints(e)}}]),t}();t.default=d}).call(t,i(0))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={camera:{position:{x:0,y:50,z:99},far:2e6,limit:{x:[-200,200,300],y:[20,150,20],z:[-200,200,300]}},leader:{limit:{x:100,y:200,z:100},ratVelocity:5},sprites:{nbVertice:1e3,colors:[[136,249,212],[151,18,75],[220,68,68],[245,168,85]],sprite:{maxSize:4,baseRadius:12}}};t.default=n},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),e.Mirror=function(t,i,n){function o(e){a.updateMatrixWorld(),f.setFromMatrixPosition(a.matrixWorld),m.setFromMatrixPosition(e.matrixWorld),v.extractRotation(a.matrixWorld),d.set(0,0,1),d.applyMatrix4(v),g.subVectors(f,m),g.reflect(d).negate(),g.add(f),v.extractRotation(e.matrixWorld),p.set(0,0,-1),p.applyMatrix4(v),p.add(m),x.subVectors(f,p),x.reflect(d).negate(),x.add(f),_.position.copy(g),_.up.set(0,1,0),_.up.applyMatrix4(v),_.up.reflect(d),_.lookAt(x),_.aspect=e.aspect,_.near=e.near,_.far=e.far,_.updateMatrixWorld(),_.updateProjectionMatrix(),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(_.projectionMatrix),w.multiply(_.matrixWorldInverse),u.setFromNormalAndCoplanarPoint(d,f),u.applyMatrix4(_.matrixWorldInverse),y.set(u.normal.x,u.normal.y,u.normal.z,u.constant);var t=_.projectionMatrix;b.x=(Math.sign(y.x)+t.elements[8])/t.elements[0],b.y=(Math.sign(y.y)+t.elements[9])/t.elements[5],b.z=-1,b.w=(1+t.elements[10])/t.elements[14],y.multiplyScalar(2/y.dot(b)),t.elements[2]=y.x,t.elements[6]=y.y,t.elements[10]=y.z+1-l,t.elements[14]=y.w}e.Mesh.call(this,new e.PlaneGeometry(t,i,256,256));var a=this;console.log(this),a.name="mirror_"+a.id,a.matrixNeedsUpdate=!0,n=n||{};var s=new e.Vector4,r=void 0!==n.textureWidth?n.textureWidth:512,c=void 0!==n.textureHeight?n.textureHeight:512,l=void 0!==n.clipBias?n.clipBias:0,h=void 0!==n.color?new e.Color(n.color):new e.Color(8355711),u=new e.Plane,d=new e.Vector3,f=new e.Vector3,m=new e.Vector3,v=new e.Matrix4,p=new e.Vector3(0,0,-1),y=new e.Vector4,g=new e.Vector3,x=new e.Vector3,b=new e.Vector4,w=new e.Matrix4,_=new e.PerspectiveCamera,M={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBFormat,stencilBuffer:!1},k=new e.WebGLRenderTarget(r,c,M);e.Math.isPowerOfTwo(r)&&e.Math.isPowerOfTwo(c)||(k.texture.generateMipmaps=!1),console.log("time",Date.now());var P={uniforms:{mirrorColor:{value:new e.Color(8355711)},mirrorSampler:{value:null},textureMatrix:{value:new e.Matrix4},u_time:{value:0}},vertexShader:["vec3 mod289(vec3 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec4 mod289(vec4 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec4 permute(vec4 x) {","return mod289(((x*34.0)+1.0)*x);","}","vec4 taylorInvSqrt(vec4 r)","{","return 1.79284291400159 - 0.85373472095314 * r;","}","float snoise(vec3 v)","{","const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;","const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);","vec3 i  = floor(v + dot(v, C.yyy) );","vec3 x0 =   v - i + dot(i, C.xxx) ;","vec3 g = step(x0.yzx, x0.xyz);","vec3 l = 1.0 - g;","vec3 i1 = min( g.xyz, l.zxy );","vec3 i2 = max( g.xyz, l.zxy );","vec3 x1 = x0 - i1 + C.xxx;","vec3 x2 = x0 - i2 + C.yyy; ","vec3 x3 = x0 - D.yyy;      ","i = mod289(i);","vec4 p = permute( permute( permute( ","i.z + vec4(0.0, i1.z, i2.z, 1.0 ))","+ i.y + vec4(0.0, i1.y, i2.y, 1.0 ))","+ i.x + vec4(0.0, i1.x, i2.x, 1.0 ));","float n_ = 0.142857142857;","vec3  ns = n_ * D.wyz - D.xzx;","vec4 j = p - 49.0 * floor(p * ns.z * ns.z);","vec4 x_ = floor(j * ns.z);","vec4 y_ = floor(j - 7.0 * x_ );","vec4 x = x_ *ns.x + ns.yyyy;","vec4 y = y_ *ns.x + ns.yyyy;","vec4 h = 1.0 - abs(x) - abs(y);","vec4 b0 = vec4( x.xy, y.xy );","vec4 b1 = vec4( x.zw, y.zw );","vec4 s0 = floor(b0)*2.0 + 1.0;","vec4 s1 = floor(b1)*2.0 + 1.0;","vec4 sh = -step(h, vec4(0.0));","vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;","vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;","vec3 p0 = vec3(a0.xy,h.x);","vec3 p1 = vec3(a0.zw,h.y);","vec3 p2 = vec3(a1.xy,h.z);","vec3 p3 = vec3(a1.zw,h.w);","vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));","p0 *= norm.x;","p1 *= norm.y;","p2 *= norm.z;","p3 *= norm.w;","vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);","m = m * m;","return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),","dot(p2,x2), dot(p3,x3) ) );","}","uniform mat4 textureMatrix;","uniform float u_time;","varying vec4 mirrorCoord;","void main() {","vec3 newPosition = position;","vec4 mvPosition = modelViewMatrix * vec4( newPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( newPosition, 1.0 );","mirrorCoord = textureMatrix * worldPosition;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 mirrorColor;","uniform sampler2D mirrorSampler;","varying vec4 mirrorCoord;","float blendOverlay(float base, float blend) {"," return( base < 0.5 ? ( 2.0 * base * blend ) : (1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","void main() {"," vec4 color = texture2DProj(mirrorSampler, mirrorCoord);"," color = vec4(blendOverlay(mirrorColor.r, color.r), blendOverlay(mirrorColor.g, color.g), blendOverlay(mirrorColor.b, color.b), 1.0);"," gl_FragColor = color;","}"].join("\n")},z=e.UniformsUtils.clone(P.uniforms),E=new e.ShaderMaterial({fragmentShader:P.fragmentShader,vertexShader:P.vertexShader,uniforms:z});E.uniforms.mirrorSampler.value=k.texture,E.uniforms.mirrorColor.value=h,E.uniforms.textureMatrix.value=w,a.material=E,a.onBeforeRender=function(e,t,i){o(i),a.visible=!1,a.material.uniforms.u_time.value+=.01;var n=e.getRenderTarget(),r=e.vr.enabled,c=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.render(t,_,k,!0),e.vr.enabled=r,e.shadowMap.autoUpdate=c,e.setRenderTarget(n);var l=i.bounds;if(void 0!==l){var h=e.getSize(),u=e.getPixelRatio();s.x=l.x*h.width*u,s.y=l.y*h.height*u,s.z=l.z*h.width*u,s.w=l.w*h.height*u,e.state.viewport(s)}a.visible=!0}},e.Mirror.prototype=Object.create(e.Mesh.prototype),t.default=e.Mirror}).call(t,i(0))},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),e.OrbitControls=function(t,i){function n(){return 2*Math.PI/60/60*D.autoRotateSpeed}function o(){return Math.pow(.95,D.zoomSpeed)}function a(e){I.theta-=e}function s(e){I.phi-=e}function r(t){D.object instanceof e.PerspectiveCamera?q/=t:D.object instanceof e.OrthographicCamera?(D.object.zoom=Math.max(D.minZoom,Math.min(D.maxZoom,D.object.zoom*t)),D.object.updateProjectionMatrix(),K=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),D.enableZoom=!1)}function c(t){D.object instanceof e.PerspectiveCamera?q*=t:D.object instanceof e.OrthographicCamera?(D.object.zoom=Math.max(D.minZoom,Math.min(D.maxZoom,D.object.zoom/t)),D.object.updateProjectionMatrix(),K=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),D.enableZoom=!1)}function l(e){W.set(e.clientX,e.clientY)}function h(e){J.set(e.clientX,e.clientY)}function u(e){Y.set(e.clientX,e.clientY)}function d(e){G.set(e.clientX,e.clientY),Z.subVectors(G,W);var t=D.domElement===document?D.domElement.body:D.domElement;a(2*Math.PI*Z.x/t.clientWidth*D.rotateSpeed),s(2*Math.PI*Z.y/t.clientHeight*D.rotateSpeed),W.copy(G),D.update()}function f(e){$.set(e.clientX,e.clientY),ee.subVectors($,J),ee.y>0?r(o()):ee.y<0&&c(o()),J.copy($),D.update()}function m(e){X.set(e.clientX,e.clientY),Q.subVectors(X,Y),ne(Q.x,Q.y),Y.copy(X),D.update()}function v(e){}function p(e){e.deltaY<0?c(o()):e.deltaY>0&&r(o()),D.update()}function y(e){switch(e.keyCode){case D.keys.UP:ne(0,D.keyPanSpeed),D.update();break;case D.keys.BOTTOM:ne(0,-D.keyPanSpeed),D.update();break;case D.keys.LEFT:ne(D.keyPanSpeed,0),D.update();break;case D.keys.RIGHT:ne(-D.keyPanSpeed,0),D.update()}}function g(e){W.set(e.touches[0].pageX,e.touches[0].pageY)}function x(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);J.set(0,n)}function b(e){Y.set(e.touches[0].pageX,e.touches[0].pageY)}function w(e){G.set(e.touches[0].pageX,e.touches[0].pageY),Z.subVectors(G,W);var t=D.domElement===document?D.domElement.body:D.domElement;a(2*Math.PI*Z.x/t.clientWidth*D.rotateSpeed),s(2*Math.PI*Z.y/t.clientHeight*D.rotateSpeed),W.copy(G),D.update()}function _(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);$.set(0,n),ee.subVectors($,J),ee.y>0?c(o()):ee.y<0&&r(o()),J.copy($),D.update()}function M(e){X.set(e.touches[0].pageX,e.touches[0].pageY),Q.subVectors(X,Y),ne(Q.x,Q.y),Y.copy(X),D.update()}function k(e){}function P(e){if(!1!==D.enabled){switch(e.preventDefault(),e.button){case D.mouseButtons.ORBIT:if(!1===D.enableRotate)return;l(e),L=F.ROTATE;break;case D.mouseButtons.ZOOM:if(!1===D.enableZoom)return;h(e),L=F.DOLLY;break;case D.mouseButtons.PAN:if(!1===D.enablePan)return;u(e),L=F.PAN}L!==F.NONE&&(document.addEventListener("mousemove",z,!1),document.addEventListener("mouseup",E,!1),D.dispatchEvent(N))}}function z(e){if(!1!==D.enabled)switch(e.preventDefault(),L){case F.ROTATE:if(!1===D.enableRotate)return;d(e);break;case F.DOLLY:if(!1===D.enableZoom)return;f(e);break;case F.PAN:if(!1===D.enablePan)return;m(e)}}function E(e){!1!==D.enabled&&(v(e),document.removeEventListener("mousemove",z,!1),document.removeEventListener("mouseup",E,!1),D.dispatchEvent(V),L=F.NONE)}function C(e){!1===D.enabled||!1===D.enableZoom||L!==F.NONE&&L!==F.ROTATE||(e.preventDefault(),e.stopPropagation(),p(e),D.dispatchEvent(N),D.dispatchEvent(V))}function A(e){!1!==D.enabled&&!1!==D.enableKeys&&!1!==D.enablePan&&y(e)}function S(e){if(!1!==D.enabled){switch(e.touches.length){case 1:if(!1===D.enableRotate)return;g(e),L=F.TOUCH_ROTATE;break;case 2:if(!1===D.enableZoom)return;x(e),L=F.TOUCH_DOLLY;break;case 3:if(!1===D.enablePan)return;b(e),L=F.TOUCH_PAN;break;default:L=F.NONE}L!==F.NONE&&D.dispatchEvent(N)}}function T(e){if(!1!==D.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===D.enableRotate)return;if(L!==F.TOUCH_ROTATE)return;w(e);break;case 2:if(!1===D.enableZoom)return;if(L!==F.TOUCH_DOLLY)return;_(e);break;case 3:if(!1===D.enablePan)return;if(L!==F.TOUCH_PAN)return;M(e);break;default:L=F.NONE}}function O(e){!1!==D.enabled&&(k(e),D.dispatchEvent(V),L=F.NONE)}function R(e){!1!==D.enabled&&e.preventDefault()}this.object=t,this.domElement=void 0!==i?i:document,this.enabled=!0,this.target=new e.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:e.MOUSE.LEFT,ZOOM:e.MOUSE.MIDDLE,PAN:e.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return U.phi},this.getAzimuthalAngle=function(){return U.theta},this.saveState=function(){D.target0.copy(D.target),D.position0.copy(D.object.position),D.zoom0=D.object.zoom},this.reset=function(){D.target.copy(D.target0),D.object.position.copy(D.position0),D.object.zoom=D.zoom0,D.object.updateProjectionMatrix(),D.dispatchEvent(j),D.update(),L=F.NONE},this.update=function(){var i=new e.Vector3,o=(new e.Quaternion).setFromUnitVectors(t.up,new e.Vector3(0,1,0)),s=o.clone().inverse(),r=new e.Vector3,c=new e.Quaternion;return function(){var e=D.object.position;return i.copy(e).sub(D.target),i.applyQuaternion(o),U.setFromVector3(i),D.autoRotate&&L===F.NONE&&a(n()),U.theta+=I.theta,U.phi+=I.phi,U.theta=Math.max(D.minAzimuthAngle,Math.min(D.maxAzimuthAngle,U.theta)),U.phi=Math.max(D.minPolarAngle,Math.min(D.maxPolarAngle,U.phi)),U.makeSafe(),U.radius*=q,U.radius=Math.max(D.minDistance,Math.min(D.maxDistance,U.radius)),D.target.add(H),i.setFromSpherical(U),i.applyQuaternion(s),e.copy(D.target).add(i),D.object.lookAt(D.target),!0===D.enableDamping?(I.theta*=1-D.dampingFactor,I.phi*=1-D.dampingFactor):I.set(0,0,0),q=1,H.set(0,0,0),!!(K||r.distanceToSquared(D.object.position)>B||8*(1-c.dot(D.object.quaternion))>B)&&(D.dispatchEvent(j),r.copy(D.object.position),c.copy(D.object.quaternion),K=!1,!0)}}(),this.dispose=function(){D.domElement.removeEventListener("contextmenu",R,!1),D.domElement.removeEventListener("mousedown",P,!1),D.domElement.removeEventListener("wheel",C,!1),D.domElement.removeEventListener("touchstart",S,!1),D.domElement.removeEventListener("touchend",O,!1),D.domElement.removeEventListener("touchmove",T,!1),document.removeEventListener("mousemove",z,!1),document.removeEventListener("mouseup",E,!1),window.removeEventListener("keydown",A,!1)};var D=this,j={type:"change"},N={type:"start"},V={type:"end"},F={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},L=F.NONE,B=1e-6,U=new e.Spherical,I=new e.Spherical,q=1,H=new e.Vector3,K=!1,W=new e.Vector2,G=new e.Vector2,Z=new e.Vector2,Y=new e.Vector2,X=new e.Vector2,Q=new e.Vector2,J=new e.Vector2,$=new e.Vector2,ee=new e.Vector2,te=function(){var t=new e.Vector3;return function(e,i){t.setFromMatrixColumn(i,0),t.multiplyScalar(-e),H.add(t)}}(),ie=function(){var t=new e.Vector3;return function(e,i){t.setFromMatrixColumn(i,1),t.multiplyScalar(e),H.add(t)}}(),ne=function(){var t=new e.Vector3;return function(i,n){var o=D.domElement===document?D.domElement.body:D.domElement;if(D.object instanceof e.PerspectiveCamera){var a=D.object.position;t.copy(a).sub(D.target);var s=t.length();s*=Math.tan(D.object.fov/2*Math.PI/180),te(2*i*s/o.clientHeight,D.object.matrix),ie(2*n*s/o.clientHeight,D.object.matrix)}else D.object instanceof e.OrthographicCamera?(te(i*(D.object.right-D.object.left)/D.object.zoom/o.clientWidth,D.object.matrix),ie(n*(D.object.top-D.object.bottom)/D.object.zoom/o.clientHeight,D.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),D.enablePan=!1)}}();D.domElement.addEventListener("contextmenu",R,!1),D.domElement.addEventListener("mousedown",P,!1),D.domElement.addEventListener("wheel",C,!1),D.domElement.addEventListener("touchstart",S,!1),D.domElement.addEventListener("touchend",O,!1),D.domElement.addEventListener("touchmove",T,!1),window.addEventListener("keydown",A,!1),this.update()},e.OrbitControls.prototype=Object.create(e.EventDispatcher.prototype),e.OrbitControls.prototype.constructor=e.OrbitControls,Object.defineProperties(e.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),t.default=e.OrbitControls}).call(t,i(0))},function(e,t,i){"use strict";(function(e){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(10),s=function(e){return e&&e.__esModule?e:{default:e}}(a),r=function(){function t(i,o,a,r){function c(){var e=l.uniforms;e.turbidity.value=u.turbidity,e.rayleigh.value=u.rayleigh,e.luminance.value=u.luminance,e.mieCoefficient.value=u.mieCoefficient,e.mieDirectionalG.value=u.mieDirectionalG;var t=Math.PI*(u.inclination-.5),n=2*Math.PI*(u.azimuth-.5);h.position.x=d.distance*Math.cos(n),h.position.y=d.distance*Math.sin(n)*Math.sin(t),h.position.z=d.distance*Math.sin(n)*Math.cos(t),h.visible=u.sun,l.uniforms.sunPosition.value.copy(h.position),a.render(i,r)}n(this,t),this.sky=new s.default;var l=this.sky;i.add(l.mesh),this.sunSphere=new e.Mesh(new e.SphereBufferGeometry(2e4,16,8),new e.MeshBasicMaterial({color:16777215}));var h=this.sunSphere;h.position.y=-7e5,h.visible=!1,i.add(h),this.effectController={turbidity:10,rayleigh:2,mieCoefficient:.005,mieDirectionalG:.8,luminance:1,inclination:1,azimuth:.25,sun:!1};var u=this.effectController;this.distance=4e5;var d=this,o=o;o.add(u,"turbidity",1,20,.1).onChange(c),o.add(u,"rayleigh",0,4,.001).onChange(c),o.add(u,"mieCoefficient",0,.1,.001).onChange(c),o.add(u,"mieDirectionalG",0,1,.001).onChange(c),o.add(u,"luminance",0,2).onChange(c),o.add(u,"inclination",1,1,1e-4).onChange(c),o.add(u,"azimuth",0,1,1e-4).onChange(c),o.add(u,"sun").onChange(c),c()}return o(t,[{key:"update",value:function(e){var t=Math.PI*((Math.cos(e)+1)/4+.25-.5),i=2*Math.PI*(this.effectController.azimuth/2-.5);this.sunSphere.position.x=this.distance*Math.cos(i),this.sunSphere.position.y=this.distance*Math.sin(i)*Math.sin(t),this.sunSphere.position.z=this.distance*Math.sin(i)*Math.cos(t),this.sunSphere.visible=this.effectController.sun,this.sky.uniforms.sunPosition.value.copy(this.sunSphere.position)}}]),t}();t.default=r}).call(t,i(0))},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),e.Sky=function(){var t=e.Sky.SkyShader,i=e.UniformsUtils.clone(t.uniforms),n=new e.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,side:e.BackSide}),o=new e.SphereBufferGeometry(45e4,32,15),a=new e.Mesh(o,n);this.mesh=a,this.uniforms=i},e.Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new e.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},t.default=e.Sky}).call(t,i(0))},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t,i,o,a){var s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n(this,e),this.ctx;try{window.AudioContext=window.AudioContext||window.webkitAudioContext,this.ctx=new AudioContext}catch(e){throw new Error("Web Audio API is not supported in this browser")}this._bpm=i,this._beatDuration=60/this._bpm,this._offsetTime=o,this._sections=[],this._kicks=[],this._beats=[],this._startTime=0,this._pauseTime=0,this._isPlaying=!1,this._isLoaded=!1,this._progress=0,this._onUpdate=this.onUpdate.bind(this),this._onEnded=this.onEnded.bind(this),this.gainNode=this.ctx.createGain(),this.gainNode.connect(this.ctx.destination),this.analyserNode=this.ctx.createAnalyser(),this.analyserNode.connect(this.gainNode),this.analyserNode.smoothingTimeConstant=.8,this.analyserNode.fftSize=512;var r=this.analyserNode.frequencyBinCount;this.frequencyDataArray=new Uint8Array(r),this.timeDomainDataArray=new Uint8Array(r),s&&(this.debug=new c(this)),this._load(t,a),window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame}return o(e,[{key:"_load",value:function(e,t){var i=this;if(e){this._isLoaded=!1,this._progress=0;var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onprogress=function(e){i._progress=e.loaded/e.total},n.onload=function(){i.ctx.decodeAudioData(n.response,function(e){i._buffer=e,i._isLoaded=!0,t&&t()},function(e){console.log(e)})},n.send()}}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.req&&cancelAnimationFrame(this.req),this._onUpdate(),this._isPlaying=!0;var t=this._pauseTime-this._startTime+e;this._startTime=this.ctx.currentTime-t,this.sourceNode=this.ctx.createBufferSource(),this.sourceNode.connect(this.analyserNode),this.sourceNode.buffer=this._buffer,this.sourceNode.start(0,t),this.sourceNode.addEventListener("ended",this._onEnded,!1)}},{key:"pause",value:function(){this.req&&cancelAnimationFrame(this.req),this.sourceNode&&(this.sourceNode.removeEventListener("ended",this._onEnded,!1),this.sourceNode.stop(0),this.sourceNode.disconnect(),this.sourceNode=null),this._pauseTime=this.ctx.currentTime,this._isPlaying=!1}},{key:"before",value:function(e,t,i){var n=this;return this._sections.push({label:e,condition:function(){return n.time<t},callback:i}),this}},{key:"after",value:function(e,t,i){var n=this;return this._sections.push({label:e,condition:function(){return n.time>t},callback:i}),this}},{key:"between",value:function(e,t,i,n){var o=this;return this._sections.push({label:e,condition:function(){return o.time>t&&o.time<i},callback:n}),this}},{key:"onceAt",value:function(e,t,i){var n=this,o=null;return this._sections.push({label:e,condition:function(){return n.time>t&&!this.called},callback:function(){console.log("once :",o.label),i.call(this),o.called=!0},called:!1}),o=this._sections[this._sections.length-1],this}},{key:"getAverage",value:function(){for(var e=0,t=this.getSpectrum(),i=0;i<this.getSpectrum().length;i++)e+=t[i];return e/t.length}},{key:"getSpectrum",value:function(){return this.analyserNode.getByteFrequencyData(this.frequencyDataArray),this.frequencyDataArray}},{key:"getWaveform",value:function(){return this.analyserNode.getByteTimeDomainData(this.timeDomainDataArray),this.timeDomainDataArray}},{key:"getFrequency",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=0,n=this.getSpectrum();if(void 0!==t){for(var o=e;o<=t;o++)i+=n[o];return i/(t-e+1)}return n[e]}},{key:"createKick",value:function(e){var t=e.frequency,i=e.threshold,n=e.decay,o=e.onKick,a=e.offKick,r=new s({frequency:t,threshold:i,decay:n,onKick:o,offKick:a});return this._kicks.push(r),r}},{key:"createBeat",value:function(e){var t=e.factor,i=e.onBeat,n=new r({factor:t,onBeat:i});return this._beats.push(n),n}},{key:"onUpdate",value:function(){this.req=requestAnimationFrame(this._onUpdate);for(var e in this._sections)this._sections[e].condition()&&this._sections[e].callback.call(this);var t=this.getSpectrum();for(var i in this._kicks)this._kicks[i].calc(t);var n=Math.max(0,this.time-this._offsetTime);for(var o in this._beats)this._beats[o].calc(n,this._beatDuration);this.debug&&this.debug.draw()}},{key:"onEnded",value:function(){this.stop()}},{key:"progress",get:function(){return this._progress}},{key:"isLoaded",get:function(){return this._isLoaded}},{key:"duration",get:function(){return this._isLoaded?this._buffer.duration:0}},{key:"time",get:function(){return this.isPlaying?this.ctx.currentTime-this._startTime:this._pauseTime-this._startTime}},{key:"volume",set:function(e){this.gainNode.gain.value=e},get:function(){return this.gainNode.gain.value}},{key:"isPlaying",get:function(){return this._isPlaying}},{key:"beatDuration",get:function(){return this._beatDuration}}]),e}();t.default=a;var s=function(){function e(t){var i=t.frequency,o=t.threshold,a=t.decay,s=t.onKick,r=t.offKick;n(this,e),this.frequency=void 0!==i?i:[0,10],this.threshold=void 0!==o?o:.3,this.decay=void 0!==a?a:.02,this.onKick=s,this.offKick=r,this.isOn=!1,this.isKick=!1,this.currentThreshold=this.threshold}return o(e,[{key:"on",value:function(){this.isOn=!0}},{key:"off",value:function(){this.isOn=!1}},{key:"set",value:function(e){var t=e.frequency,i=e.threshold,n=e.decay,o=e.onKick,a=e.offKick;this.frequency=void 0!==t?t:this.frequency,this.threshold=void 0!==i?i:this.threshold,this.decay=void 0!==n?n:this.decay,this.onKick=o||this.onKick,this.offKick=a||this.offKick}},{key:"calc",value:function(e){if(this.isOn){var t=this.maxAmplitude(e,this.frequency);t>=this.currentThreshold&&t>=this.threshold?(this.currentThreshold=t,this.onKick&&this.onKick(t),this.isKick=!0):(this.offKick&&this.offKick(t),this.currentThreshold-=this.decay,this.isKick=!1)}}},{key:"maxAmplitude",value:function(e,t){var i=0;if(!t.length)return t<e.length?e[~~t]:null;for(var n=t[0],o=t[1];n<=o;n++)e[n]>i&&(i=e[n]);return i}}]),e}(),r=function(){function e(t){var i=t.factor,o=t.onBeat;n(this,e),this.factor=void 0!==i?i:1,this.onBeat=o,this.isOn=!1,this.currentTime=0}return o(e,[{key:"on",value:function(){this.isOn=!0}},{key:"off",value:function(){this.isOn=!1}},{key:"set",value:function(e){var t=e.factor,i=e.onBeat;this.factor=void 0!==t?t:this.factor,this.onBeat=i||this.onBeat}},{key:"calc",value:function(e,t){if(0!=e){var i=t*this.factor;e>=this.currentTime+i&&(this.isOn&&this.onBeat&&this.onBeat(),this.currentTime+=i)}}}]),e}(),c=function(){function e(t){n(this,e),this.sound=t,this.canvas=document.createElement("canvas"),this.canvas.width=512,this.canvas.height=300,this.canvas.style.position="absolute",this.canvas.style.bottom=0,this.canvas.style.left=0,this.canvas.style.zIndex=3,document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),window.addEventListener("resize",this.resize.bind(this),!1),this.resize()}return o(e,[{key:"resize",value:function(){this.canvas.width=window.innerWidth}},{key:"draw",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.rect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#000000",this.ctx.fill(),this.ctx.strokeStyle="#a1a1a1",this.ctx.stroke(),this.ctx.beginPath();for(var e=this.sound.getSpectrum(),t=null,i=e.length,n=this.canvas.width/i,o=this.canvas.height-10,a=0;a<i;a++)t=e[a]/256,this.ctx.rect(a*n,o-o*t,n/2,o*t);this.ctx.fillStyle="#ffffff",this.ctx.fill(),this.ctx.beginPath(),this.ctx.font="10px Arial",this.ctx.textBaseline="middle",this.ctx.textAlign="left";for(var s=0,r=i;s<r;s++)s%10==0&&(this.ctx.rect(s*n,o,n/2,10),this.ctx.fillText(s,s*n+4,o+5));this.ctx.fillStyle="#ffffff",this.ctx.fill();for(var c=this.sound._kicks,l=null,h=c.length,u=null,d=null,f=0,m=h;f<m;f++)l=c[f],l.isOn&&(u=l.frequency.length?l.frequency[0]:l.frequency,d=l.frequency.length?l.frequency[1]-l.frequency[0]+1:1,this.ctx.beginPath(),this.ctx.rect(u*n,o-o*(l.threshold/256),d*n-.5*n,2),this.ctx.rect(u*n,o-o*(l.currentThreshold/256),d*n-.5*n,5),this.ctx.fillStyle=l.isKick?"#00ff00":"#ff0000",this.ctx.fill());this.ctx.beginPath();for(var v=this.sound.getWaveform(),p=null,y=v.length,g=this.canvas.width/y,x=this.canvas.height-10,b=0;b<y;b++)p=v[b]/256,0==b?this.ctx.moveTo(b*g,x*p):this.ctx.lineTo(b*g,x*p);this.ctx.strokeStyle="#0000ff",this.ctx.stroke(),this.ctx.beginPath(),this.ctx.textAlign="right",this.ctx.textBaseline="top",this.ctx.font="15px Arial",this.ctx.fillStyle="#ffffff",this.ctx.fillText(Math.round(10*this.sound.time)/10+" / "+Math.round(10*this.sound.duration)/10,this.canvas.width-5,5),this.ctx.beginPath();for(var w=this.sound._sections,_=null,M=w.length,k="",P=0,z=M;P<z;P++)_=w[P],_.condition()&&(k+=_.label+" - ");k.length>0&&(k=k.substr(0,k.length-3)),this.ctx.fillText(k,this.canvas.width-5,25),this.ctx.fill()}}]),e}()},function(e,t,i){e.exports=i.p+"sound.e7d3cdc788968ee2474a1a5bf93099bd.mp3"},,,function(e,t){e.exports="varying float f_alpha;\nuniform vec3 u_color_from;\n\nvoid main() {\n\tfloat advance = 1.0;\n\tgl_FragColor = vec4(\n\t\tu_color_from.x*f_alpha, \n\t\tu_color_from.y*f_alpha, \n\t\tu_color_from.z*f_alpha, \n\t\t0.3+0.7*f_alpha);\n}"},function(e,t){e.exports="uniform float u_time;\n// uniform vec3 u_leader;\n// uniform float u_max_size;\n// uniform float u_position_noise_rat;\nuniform float u_factor;\n\nuniform float u_ball_base_radius;\nuniform float u_nb_vertex;\n\nattribute float rank;\nattribute float rand;\nvarying float f_alpha;\n\n#define M_PI 3.1415926535897932384626433832795\n// uniform vec3[] u_originPosition;\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex \n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n// \n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise(vec3 v)\n  { \n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i); \n  vec4 p = permute( permute( permute( \n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\n  vec3 snoiseVec3( vec3 x ){\n\n  float s  = snoise(vec3( x ));\n  float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n\n}\n\n\nvec3 curlNoise( vec3 p ){\n  \n  const float e = .1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3( p - dx );\n  vec3 p_x1 = snoiseVec3( p + dx );\n  vec3 p_y0 = snoiseVec3( p - dy );\n  vec3 p_y1 = snoiseVec3( p + dy );\n  vec3 p_z0 = snoiseVec3( p - dz );\n  vec3 p_z1 = snoiseVec3( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n\n}\n\nvoid main() {\n  float angle1 = M_PI / u_nb_vertex * rank;\n  f_alpha = rank/u_nb_vertex;\n\n  vec3 newPosition = vec3(\n    position.x + cos(angle1)*sin(rand),\n    position.y + sin(angle1)*sin(rand),\n    position.z + cos(rand)\n    );\n\n    vec3 noiseValue = curlNoise(vec3(u_time, 10. , f_alpha* u_factor ));\n    gl_PointSize = 2.0 + 2. * f_alpha;\n    newPosition =  position + noiseValue * u_ball_base_radius;\n    \n  \n  gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);\n}"}],[4]);